# Doing Pack

**Demonstrate using Python3**  
Obfuscating Python source code and then package it into an executable file.

## Obfuscator source code

Transform python source code into obfuscated python code.

### [PyObfx](https://github.com/PyObfx/PyObfx) (Simple use)

- Obfuscates strings, integers, floats, booleans, variable names, and import names.
- Compress source code (bz2, gz, lzma).
- **This repository has been archived by the owner on Dec 6, 2020.**

```bash
git clone https://github.com/PyObfx/PyObfx.git && cd PyObfx
pip install -r requirements.txt
python PyObfx.py app.py -p lzma
```

### [PyObfuscate](https://github.com/htr-tech/PyObfuscate) (Simple use)

- Use Marshal for serializing data.
- Use Base16/32/64 for encoding.
- Use Zlib for compression.

```bash
git clone https://github.com/htr-tech/PyObfuscate.git && cd PyObfuscate
python encode.py
```

### [pyarmor](https://github.com/dashingsoft/pyarmor) (Moderate use)

- **Seamless Replacement**: Obfuscated scripts remain as standard `.py` files, allowing them to seamlessly replace the original Python scripts in most cases.
- **Balanced Obfuscation**: Offers multiple ways to obfuscate scripts to balance security and performance.
- **Irreversible Obfuscation**: Renames functions, methods, classes, variables, and arguments.
- **C Function Conversion**: Converts some Python functions to C functions and compiles them into machine instructions using high optimization options for irreversible obfuscation.
- **Script Binding**: Binds obfuscated scripts to specific machines or sets expiration dates for obfuscated scripts.
- The free trial version has some limitations.

```
pip install pyarmor
python -m pyarmor.cli

# Obfuscation Source Code
python -m pyarmor.cli gen app.py
python dist/app.py
```

### [Intensio-Obfuscator](https://github.com/Hnfull/Intensio-Obfuscator) (Moderate use)

- **Replace** all names of `variables/classes/functions/files-name` to random strings with length defined then all chars to their hexadecimal value.
- **Delete** all `comments`, all `spaces lines`.
- **Padding** random `snippets code/functions/classes` with an always differents values.
- Provides a high level obfuscation layer to prevent or delay the reading and understanding of your python program.

### [python-obfuscation](https://github.com/FormulaMonks/python-obfuscation)

Playground for python based project obfuscation techniques.

- Bytecode(easily converted back)
  - pyc
  - pyo
- Cython
  - Cython will compile the given python module into a `.c` source code, which is then compiled by `gcc` as a shared library (`.so`). Finally, the `.py` files can be removed, leaving just the `.so`.
- Custom Interpreter
  - Customizing the CPython interpreter in order to introduce protection measures to avoid the reverse engineering of the codebase.
- Import hook
  - Use an import hook in order to detect encrypted modules on import time.
- Abstract Syntax Trees
  - **Hidding Strings**: Encode strings by processing the walking through the Abstract Syntax Trees.
  - **Code Scrambling**: Use of Python Abstract Syntax Trees and an import hook in order to scramble code and unscramble it on import time.
- **This repository has been archived by the owner on Jan 29, 2020.**

### [Phantom-Evasion](https://github.com/oddcod3/Phantom-Evasion) (Advanced use)

Phantom-Evasion is an antivirus evasion tool written in python (both compatible with python and python3) capable to generate (almost) fully undetectable executable even with the most common x86 msfvenom payload.

- **This repository has been archived by the owner on Nov 7, 2023.**

## Convert to executable

### [pyinstaller](https://pyinstaller.org/en/stable/)

PyInstaller bundles a Python application and all its dependencies into a single package. The user can run the packaged app without installing a Python interpreter or any modules.

- **Ease of Distribution**: One of the primary advantages of PyInstaller is its ability to create self-contained executable files.
- **Cross-Platform Compatibility**: PyInstaller supports cross-compilation, allowing you to create executables for multiple platforms from a single development environment.

```bash
pip install pyinstaller
python -m PyInstaller -F app.py
./dist/app.exe
```

### [nuitka](https://nuitka.net/)

Nuitka translates the Python modules into a C level program that then uses libpython and static C files of its own to execute in the same way as CPython does.

- All optimization is aimed at avoiding overhead, where it's unnecessary.
- Smaller file size

```bash
pip install -U nuitka
python -m nuitka --standalone --onefile app.py
```

### [pyarmor](https://github.com/dashingsoft/pyarmor)

- Packing files into one bundle by PyInstaller, py2exe, py2app, cx_Freeze.
- **Themida Protection**: Protects obfuscated scripts using Themida (Windows only).

```
# Obfuscation Source Code And Packed
python -m pyarmor.cli gen --pack onefile .\app.py
```

### [Pakkero](https://github.com/89luca89/pakkero)

Pakkero is a binary packer written in Go made for fun and educational purpose.  
Its main goal is to take in input a program file (elf binary, script, even appimage) and compress it, protect it from tampering and intrusion.

```bash
go get github.com/89luca89/pakkero
cd $GOPATH/src/github.com/89luca89/pakkero; make
pakkero --file ./target-file -o ./output-file -register-dep dependency-file -c
```

### [RustPacke](https://github.com/Nariod/RustPacker)

Template-based shellcode packer written in Rust, with indirect syscall support.

```bash
git clone https://github.com/Nariod/RustPacker.git
cd RustPacker/
podman build -t rustpacker -f Dockerfile
podman run --rm -v $(pwd)/shared:/usr/src/RustPacker/shared:z rustpacker RustPacker -f shared/calc.raw -i syscrt -e aes -b exe -t smartscreen.exe
```

### [hm-pe-packer](https://github.com/TheAenema/hm-pe-packer)

A x64 PE Packer/Protector Developed in C++ and VisualStudio.  
A source repo for complete tutorial, if you want to create your own packer, you can refer to this article.[^Tutorial]

## More Tools

[https://github.com/JarVices/MsfMania](https://github.com/JarVices/MsfMania)  
[https://github.com/facundobatista/pyempaq](https://github.com/facundobatista/pyempaq)  
[https://github.com/cdong1012/Malware-Packer](https://github.com/cdong1012/Malware-Packer)

## Resource

[https://github.com/frank2/packer-tutorial](https://github.com/frank2/packer-tutorial)  
[https://www.ringzerolabs.com/2020/09/analyzing-python-malware.html](https://www.ringzerolabs.com/2020/09/analyzing-python-malware.html)  
[https://www.cyborgsecurity.com/cyborg-labs/python-malware-on-the-rise/](https://www.cyborgsecurity.com/cyborg-labs/python-malware-on-the-rise/)

[^Tutorial]: [Creating Your Very Own x64 PE Packer/Protector from Scratch using C++](https://www.codeproject.com/Articles/5317556/Creating-Your-Very-Own-x64-PE-Packer-Protector-fro)
